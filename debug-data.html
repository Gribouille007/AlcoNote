<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Debug Database - AlcoNote</title>
    <script src="https://unpkg.com/dexie@3.2.4/dist/dexie.js"></script>
</head>
<body>
    <h1>Debug Database AlcoNote</h1>
    <button id="addData">Add Today's Data</button>
    <button id="checkData">Check Database</button>
    <button id="clearData">Clear All</button>
    <button id="openApp">Open AlcoNote</button>
    
    <div id="status"></div>

    <script>
        // Initialize database
        const db = new Dexie('AlcoNoteDB');
        db.version(1).stores({
            categories: '++id, name, drinkCount, createdAt, updatedAt',
            drinks: '++id, name, category, quantity, unit, alcoholContent, date, time, location, barcode, createdAt, updatedAt',
            settings: 'key, value, updatedAt'
        });

        const statusDiv = document.getElementById('status');

        function log(message) {
            console.log(message);
            statusDiv.innerHTML += '<p>' + message + '</p>';
        }

        document.getElementById('addData').addEventListener('click', async () => {
            try {
                log('Adding today\'s data...');
                const now = new Date();
                const today = '2025-09-21'; // Fixed date for testing

                // Clear and add categories
                await db.categories.clear();
                await db.categories.bulkAdd([
                    { name: 'Bière', drinkCount: 0, createdAt: now, updatedAt: now },
                    { name: 'Vin', drinkCount: 0, createdAt: now, updatedAt: now },
                    { name: 'Spiritueux', drinkCount: 0, createdAt: now, updatedAt: now }
                ]);
                log('Categories added');

                // Clear and add drinks for today
                await db.drinks.clear();
                const drinks = [
                    {
                        name: 'Heineken',
                        category: 'Bière',
                        quantity: 1,
                        unit: 'EcoCup',
                        alcoholContent: 5,
                        date: today,
                        time: '18:00',
                        location: { latitude: 50.8503, longitude: 4.3517, address: 'Brussels, Belgium' },
                        createdAt: now,
                        updatedAt: now
                    },
                    {
                        name: 'Stella Artois',
                        category: 'Bière',
                        quantity: 1,
                        unit: 'EcoCup',
                        alcoholContent: 5.2,
                        date: today,
                        time: '19:30',
                        location: { latitude: 50.8503, longitude: 4.3517, address: 'Brussels, Belgium' },
                        createdAt: now,
                        updatedAt: now
                    },
                    {
                        name: 'Chardonnay',
                        category: 'Vin',
                        quantity: 150,
                        unit: 'cL',
                        alcoholContent: 12.5,
                        date: today,
                        time: '20:15',
                        location: { latitude: 50.8503, longitude: 4.3517, address: 'Brussels, Belgium' },
                        createdAt: now,
                        updatedAt: now
                    }
                ];

                for (const drink of drinks) {
                    await db.drinks.add(drink);
                }

                // Add user settings
                await db.settings.clear();
                await db.settings.bulkAdd([
                    { key: 'userWeight', value: 70, updatedAt: now },
                    { key: 'userGender', value: 'male', updatedAt: now }
                ]);

                log(`Successfully added ${drinks.length} drinks for ${today}`);
                
            } catch (error) {
                log('Error: ' + error.message);
                console.error(error);
            }
        });

        document.getElementById('checkData').addEventListener('click', async () => {
            try {
                const categories = await db.categories.toArray();
                const drinks = await db.drinks.toArray();
                const settings = await db.settings.toArray();

                log(`Categories: ${categories.length}`);
                categories.forEach(cat => log(`  - ${cat.name}`));

                log(`Drinks: ${drinks.length}`);
                drinks.forEach(drink => log(`  - ${drink.name} (${drink.date} ${drink.time})`));

                log(`Settings: ${settings.length}`);
                settings.forEach(setting => log(`  - ${setting.key}: ${setting.value}`));

                // Test date range query
                const todayDrinks = await db.drinks.where('date').between('2025-09-21', '2025-09-21', true, true).toArray();
                log(`Drinks for 2025-09-21: ${todayDrinks.length}`);
                
            } catch (error) {
                log('Error checking data: ' + error.message);
                console.error(error);
            }
        });

        document.getElementById('clearData').addEventListener('click', async () => {
            try {
                await db.categories.clear();
                await db.drinks.clear();
                await db.settings.clear();
                log('All data cleared');
            } catch (error) {
                log('Error clearing data: ' + error.message);
            }
        });

        document.getElementById('openApp').addEventListener('click', () => {
            window.open('index.html', '_blank');
        });
    </script>
</body>
</html>
