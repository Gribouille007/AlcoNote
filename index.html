<!DOCTYPE html>
<!-- Page principale de l'application AlcoNote PWA -->
<html lang="fr">

<head>
    <meta charset="UTF-8">
    <!-- Configuration de la viewport pour le responsive design -->
    <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no">
    <title>AlcoNote - Suivi de Consommation d'Alcool</title>
    <meta name="description"
        content="Application PWA pour suivre votre consommation d'alcool avec scanner de codes-barres, statistiques d√©taill√©es et fonctionnement hors ligne.">
    <meta name="keywords" content="alcool, consommation, suivi, PWA, scanner, statistiques, sant√©">
    <meta name="author" content="AlcoNote">

    <!-- M√©tadonn√©es PWA pour l'installation et l'apparence -->
    <meta name="theme-color" content="#007AFF">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="AlcoNote">

    <!-- En-t√™tes de s√©curit√© pour prot√©ger l'application -->
    <!-- CSP temporairement d√©sactiv√©e pour diagnostic -->
    <!-- <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'unsafe-inline' https://cdn.jsdelivr.net https://unpkg.com; style-src 'self' 'unsafe-inline' https://unpkg.com; img-src 'self' data: https:; connect-src 'self' https://world.openfoodfacts.org https://nominatim.openstreetmap.org https://api.upcitemdb.com https://api.barcodelookup.com; media-src 'self'; worker-src 'self' blob:; child-src 'self' blob:;"> -->
    <meta http-equiv="X-Content-Type-Options" content="nosniff">
    <meta http-equiv="X-Frame-Options" content="DENY">
    <meta http-equiv="X-XSS-Protection" content="1; mode=block">

    <!-- Manifest pour la PWA -->
    <link rel="manifest" href="manifest.json">

    <!-- Ic√¥nes de l'application -->
    <link rel="apple-touch-icon" href="assets/icons/icon-192x192.png">
    <link rel="icon" type="image/png" sizes="192x192" href="assets/icons/icon-192x192.png">

    <!-- Feuilles de style principales -->
    <link rel="stylesheet" href="css/main.css">
    <link rel="stylesheet" href="css/components.css">
    <link rel="stylesheet" href="css/responsive.css">
    <link rel="stylesheet" href="css/accessibility.css">

    <!-- Biblioth√®ques JavaScript externes -->
    <!-- Chart.js pour les graphiques statistiques -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- QuaggaJS pour la lecture de codes-barres -->
    <script src="https://cdn.jsdelivr.net/npm/quagga@0.12.1/dist/quagga.min.js"></script>
    <!-- Dexie.js pour IndexedDB -->
    <script src="https://unpkg.com/dexie@3.2.4/dist/dexie.js"></script>
    <!-- Leaflet pour les cartes interactives -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.5.3/dist/MarkerCluster.css" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.5.3/dist/MarkerCluster.Default.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="https://unpkg.com/leaflet.markercluster@1.5.3/dist/leaflet.markercluster.js"></script>
    <script>
        window.MathJax = {
            tex: { inlineMath: [['$', '$'], ['\\(', '\\)']] },
            chtml: { scale: 1 }
        };
    </script>
    <script defer src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"></script>
</head>

<body>
    <!-- Conteneur principal de l'application -->
    <div id="app">
        <!-- En-t√™te de l'application avec menu param√®tres -->
        <header class="app-header">
            <button id="settings-btn" class="settings-btn" aria-label="Param√®tres">
                <div class="hamburger-icon">
                    <span></span>
                    <span></span>
                    <span></span>
                </div>
            </button>
            <h1 class="app-title">AlcoNote</h1>
            <div class="header-spacer"></div>
        </header>

        <!-- Contenu principal avec navigation par onglets -->
        <main class="main-content">
            <!-- Navigation par onglets -->
            <nav class="tab-navigation">
                <button class="tab-btn active" data-tab="categories">Cat√©gories</button>
                <button class="tab-btn" data-tab="history">Historique</button>
                <button class="tab-btn" data-tab="statistics">Statistiques</button>
            </nav>

            <!-- Onglet Cat√©gories - liste des cat√©gories de boissons -->
            <section id="categories-tab" class="tab-content active">
                <div class="categories-container">
                    <div id="categories-list" class="categories-list">
                        <!-- Les cat√©gories seront charg√©es dynamiquement ici -->
                    </div>
                </div>
            </section>

            <!-- Onglet Historique - liste chronologique des consommations -->
            <section id="history-tab" class="tab-content">
                <div class="history-container">
                    <div id="history-list" class="history-list">
                        <!-- L'historique sera charg√© dynamiquement ici -->
                    </div>
                </div>
            </section>

            <!-- Onglet Statistiques - graphiques et analyses -->
            <section id="statistics-tab" class="tab-content">
                <div class="statistics-container">
                    <!-- S√©lecteur de p√©riode temporelle -->
                    <div class="period-selector">
                        <button class="period-btn active" data-period="today">Aujourd'hui</button>
                        <button class="period-btn" data-period="week">Semaine</button>
                        <button class="period-btn" data-period="month">Mois</button>
                        <button class="period-btn" data-period="year">Ann√©e</button>
                        <button class="period-btn" data-period="custom">Personnalis√©</button>
                    </div>

                    <!-- Navigation temporelle (pr√©c√©dent/suivant) -->
                    <div id="period-navigation" class="period-navigation active">
                        <button id="prev-period" class="nav-btn">‚Äπ</button>
                        <span id="current-period-display" class="current-date"></span>
                        <button id="next-period" class="nav-btn">‚Ä∫</button>
                    </div>

                    <!-- Contenu des statistiques -->
                    <div id="statistics-content" class="statistics-content">
                        <!-- Les statistiques seront charg√©es dynamiquement ici -->
                    </div>
                </div>
            </section>
        </main>

        <!-- Bouton d'action flottant (visible uniquement dans l'onglet cat√©gories) -->
        <div class="fab-container" id="fab-container">
            <button id="add-category-btn" class="fab-main" aria-label="Ajouter une cat√©gorie">
                <span class="fab-icon">+</span>
            </button>
        </div>
    </div>

    <!-- Fen√™tres modales de l'application -->
    <!-- Modal d'ajout de boisson -->
    <div id="add-drink-modal" class="modal popup-modal">
        <div class="modal-backdrop"></div>
        <div class="modal-content popup-content">
            <div class="modal-header">
                <h2>Ajouter une boisson</h2>
                <button class="modal-close" data-modal="add-drink-modal">&times;</button>
            </div>
            <form id="add-drink-form" class="modal-form">
                <div class="form-group">
                    <label for="drink-name">Nom de la boisson</label>
                    <input type="text" id="drink-name" name="name" required>
                    <button type="button" id="scan-barcode-btn" class="btn-secondary"
                        aria-label="Scanner un code-barres" style="margin-top: 8px;">üì∑ Scanner</button>
                    <div id="drink-suggestions" class="suggestions-list"></div>
                </div>

                <div class="form-group" id="category-form-group">
                    <label for="drink-category">Cat√©gorie</label>
                    <select id="drink-category" name="category" required>
                        <option value="">S√©lectionner une cat√©gorie</option>
                    </select>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="drink-quantity">Quantit√©</label>
                        <input type="number" id="drink-quantity" name="quantity" step="0.1" min="0" inputmode="decimal"
                            required>
                    </div>
                    <div class="form-group">
                        <label for="drink-unit">Unit√©</label>
                        <select id="drink-unit" name="unit" required>
                            <option value="EcoCup">EcoCup (25cL)</option>
                            <option value="cL">cL</option>
                            <option value="L">L</option>
                        </select>
                    </div>
                </div>

                <div class="form-group">
                    <label for="drink-alcohol">Degr√© d'alcool (%)</label>
                    <input type="number" id="drink-alcohol" name="alcoholContent" step="0.1" min="0" max="100">
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="drink-date">Date</label>
                        <input type="date" id="drink-date" name="date" required>
                    </div>
                    <div class="form-group">
                        <label for="drink-time">Heure</label>
                        <input type="time" id="drink-time" name="time" required>
                    </div>
                </div>

                <div class="form-actions">
                    <button type="button" class="btn-secondary" data-modal="add-drink-modal">Annuler</button>
                    <button type="submit" class="btn-primary">Ajouter</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal d'ajout de cat√©gorie -->
    <div id="add-category-modal" class="modal popup-modal">
        <div class="modal-backdrop"></div>
        <div class="modal-content popup-content">
            <div class="modal-header">
                <h2>Ajouter une cat√©gorie</h2>
                <button class="modal-close" data-modal="add-category-modal">&times;</button>
            </div>
            <form id="add-category-form" class="modal-form">
                <div class="form-group">
                    <label for="category-name">Nom de la cat√©gorie</label>
                    <input type="text" id="category-name" name="name" required>
                </div>

                <div class="form-actions">
                    <button type="button" class="btn-secondary" data-modal="add-category-modal">Annuler</button>
                    <button type="submit" class="btn-primary">Ajouter</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal du scanner de code-barres -->
    <div id="scanner-modal" class="modal">
        <div class="modal-content scanner-content">
            <div class="modal-header">
                <h2>Scanner un code-barres</h2>
                <button class="modal-close" data-modal="scanner-modal">&times;</button>
            </div>
            <div id="scanner-container" class="scanner-container">
                <div id="scanner-viewport" class="scanner-viewport"></div>
                <div class="scanner-overlay">
                    <div class="scanner-frame"></div>
                </div>
            </div>
            <div class="scanner-status">
                <p id="scanner-status-text">Positionnez le code-barres dans le cadre</p>
            </div>
        </div>
    </div>

    <!-- Menu des param√®tres -->
    <div id="settings-menu" class="settings-menu">
        <div class="settings-content">
            <div class="settings-header">
                <h2>Param√®tres</h2>
                <button id="settings-close" class="settings-close">&times;</button>
            </div>
            <div class="settings-body">
                <div class="settings-section">
                    <h3>Apparence</h3>
                    <div class="form-group">
                        <label for="theme-toggle">Th√®me</label>
                        <select id="theme-toggle">
                            <option value="light">Clair</option>
                            <option value="dark">Sombre</option>
                        </select>
                    </div>
                </div>

                <div class="settings-section">
                    <h3>Profil</h3>
                    <div class="form-group">
                        <label for="user-weight">Poids (kg)</label>
                        <input type="number" id="user-weight" step="0.1" min="30" max="200">
                    </div>
                    <div class="form-group">
                        <label for="user-gender">Sexe</label>
                        <select id="user-gender">
                            <option value="">Non sp√©cifi√©</option>
                            <option value="male">Homme</option>
                            <option value="female">Femme</option>
                        </select>
                    </div>
                </div>

                <div class="settings-section">
                    <h3>Donn√©es</h3>
                    <button id="export-data" class="btn-secondary">Exporter les donn√©es</button>
                    <button id="import-data" class="btn-secondary">Importer les donn√©es</button>
                    <button id="clear-data" class="btn-danger">Effacer toutes les donn√©es</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal de d√©tails de boisson -->
    <div id="drink-detail-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="drink-detail-title"></h2>
                <button class="modal-close" data-modal="drink-detail-modal">&times;</button>
            </div>
            <div id="drink-detail-content" class="drink-detail-content">
                <!-- Les d√©tails de la boisson seront charg√©s dynamiquement ici -->
            </div>
            <div class="modal-actions">
                <button id="add-same-drink" class="btn-primary">Ajouter cette boisson</button>
            </div>
        </div>
    </div>

    <!-- Scripts JavaScript de l'application -->
    <!-- Charg√©s dans l'ordre des d√©pendances -->
    <script src="js/error-tracking.js"></script>
    <script src="js/performance-optimizer.js"></script>
    <script src="js/database.js"></script>
    <script src="js/utils.js"></script>
    <script src="js/geolocation.js"></script>
    <script src="js/scanner.js"></script>

    <!-- Nouveau syst√®me de statistiques modulaire -->
    <!-- Configuration des statistiques -->
    <script src="js/stats-config.js"></script>

    <!-- Calculateurs -->
    <script src="js/stats-calculators/general.js"></script>
    <script src="js/stats-calculators/temporal.js"></script>
    <script src="js/stats-calculators/categories.js"></script>
    <script src="js/stats-calculators/drinks.js"></script>
    <script src="js/stats-calculators/health.js"></script>
    <script src="js/stats-calculators/location.js"></script>

    <!-- Renderers -->
    <script src="js/stats-renderers/general-renderer.js"></script>
    <script src="js/stats-renderers/temporal-renderer.js"></script>
    <script src="js/stats-renderers/category-renderer.js"></script>
    <script src="js/stats-renderers/drinks-renderer.js"></script>
    <script src="js/stats-renderers/health-renderer.js"></script>
    <script src="js/stats-renderers/location-renderer.js"></script>

    <!-- Ancien syst√®me (gard√© en backup) -->
    <script src="js/statistics.js"></script>

    <!-- Nouveau gestionnaire -->
    <script src="js/statistics-new.js"></script>

    <script src="js/app.js"></script>
</body>

</html>